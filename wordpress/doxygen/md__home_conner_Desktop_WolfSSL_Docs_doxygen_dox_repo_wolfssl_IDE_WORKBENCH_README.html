<!-- HTML header for doxygen 1.8.14-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Wind River Workbench using VxWorks with wolfSSL</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Wind River Workbench using VxWorks with <a class="el" href="namespacewolfSSL.html">wolfSSL</a> </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h4>1 Steps to Add <a class="el" href="namespacewolfSSL.html">wolfSSL</a> to Workbench Project</h4>
<ol type="1">
<li>Start by creating a new VxWorks image in Workbench by going to File &gt; New &gt; Project and then selecting VxWorks Image Project.</li>
<li>Right click on the project and go to Import &gt; General &gt; Filesystem. Click Next. Choose the path to the <a class="el" href="namespacewolfSSL.html">wolfSSL</a> library here. Uncheck everything except the examples, src and wolfcrypt directories. Uncheck the following: <pre class="fragment">    wolfcrypt/src/aes_asm.asm
    wolfcrypt/src/aes_asm.s
    examples/echoclient/
    examples/echoserver/
    wolfcrypt/user-crypto

Uncheck "Create top level folder". Click Finish.
</pre></li>
<li>To include the path to the <a class="el" href="namespacewolfSSL.html">wolfSSL</a> header files, right click on the project and go to Properties &gt; Build Properties and select the "Paths" tab. Click "Add" then "Browse" and select: <pre class="fragment">    &lt;path_to_wolfssl&gt;/

Click "OK" then "OK" again.
</pre></li>
<li>In <code>&lt;path_to_wolfssl&gt;/wolfssl/wolfcrypt/settings.h</code>, uncomment <pre class="fragment"> #define WOLFSSL_VXWORKS
</pre></li>
</ol>
<p>Note: pthreads defined by default</p>
<ol type="1">
<li><p class="startli">If using the VxWorks simulator add the following to EXTRA_DEFINE: </p><pre class="fragment"> -DVXWORKS_SIM /* only if using the VxWorks simulator */
</pre><p class="startli">This can be done by right clicking on the project in Project Explorer, going to Build Properties and selecting the "Variables" tab. Highlight EXTRA_DEFINE and click "Edit". Enter the above define to the end of the line.</p>
</li>
<li>Copy the certs folder in <code>&lt;path_to_wolfssl&gt;/</code> to the Wind River Workbench workspace folder. This is where the simulator looks for the filesystem.</li>
<li>Include Entropy:<ul>
<li>Create a new project, similar to step 1 but choose VxWorks Source Build Project as the type of project instead of VxWorks Image Project.</li>
<li>In the project directory, double click "Source Build Configuration" and under os &gt; core &gt; CORE_KERNEL Menu &gt; VxWorks Kernel Component Configuration find "Inject entropy in interrupts". Double click this.</li>
<li>Go back to your VIP project. Right click the project and select "Properties".</li>
<li>In "Properties", select "Project References". Check the box next to the new project you created. Click "Ok".</li>
<li>Rebuild the project.</li>
</ul>
</li>
</ol>
<h4>2 Testing <a class="el" href="namespacewolfSSL.html">wolfSSL</a> with VxWorks:</h4>
<h5>2.1 wolfCrypt Test and Benchmark Applications</h5>
<p>The wolfCrypt test application will test each of the cryptographic algorithms and output the status for each as a success or failure. The benchmark application will output the runtime of the cryptographic algorithms in milliseconds.</p>
<ol type="1">
<li>Include the following at the top of usrAppInit.c: <pre class="fragment"> #include &lt;wolfcrypt/test/test.h&gt;
 #include &lt;wolfssl/ssl.h&gt;
 #include &lt;wolfssl/wolfcrypt/settings.h&gt;
 #include &lt;wolfssl/test.h&gt;
 extern int benchmark_test(void* args);
</pre></li>
<li>In usrAppInit.c, make a call to the wolfCrypt test and benchmark applications by adding the following to the usrAppInit() function: <pre class="fragment">    typedef struct func_args {
        int    argc;
        char** argv;
        int    return_code;
        tcp_ready* signal;
        callback_functions *callbacks;
    } func_args;

    func_args args;

    wolfcrypt_test(&amp;args);
    benchmark_test(&amp;args);
</pre></li>
<li>Right click on the project and select "Build Project".</li>
<li>To run the VxWorks simulator, click the dropdown list next to "VxWorks Simulator" at the top of Workbench and go to "Open Connection Details". Add the correct Kernel Image file. This will be located in <code>workspace/&lt;project_name&gt;/default/vxWorks</code>. Click Apply. Start the simulator by clicking the green, "Connect 'VxWorks Simulator'" button to the right of the "VxWorks Simulator" dropdown list. Verify in the simulator terminal that all wolfCrypt tests pass.</li>
</ol>
<h5>2.2 Example Client</h5>
<p>The <a class="el" href="namespacewolfSSL.html">wolfSSL</a> example client.c file can be found in <code>&lt;path_to_wolfssl&gt;/wolfssl/examples/client</code>.</p>
<ol type="1">
<li>Add the following include to usrAppInit.c: <pre class="fragment"> #include &lt;examples/client/client.h&gt;
</pre></li>
<li>In usrAppInit.c, include the <a class="el" href="structfunc__args.html">func_args</a> as described in the Test Application section, and add a call to the client function: <pre class="fragment">    client_test(&amp;args);
</pre></li>
<li>The char* host in <code>examples/client/client.c</code> will need to be changed to the IP address to connect to. For example: <pre class="fragment"> char* host = "192.168.15.1";
</pre></li>
<li>Right click on the project and select "Build Project".</li>
<li>If using the VxWorks Simulator, localhost will not work. NAT should be selected in the Simulator Connection Advanced setup. To do this, click the dropdown button next to VxWorks Simulator at the top of Workbench and select "Open Connection Details". Make sure the correct kernel image file is selected for you project as stated in section 3.1 step 4. Then click Advanced and select NAT as the Network Config. Click OK and Apply.</li>
<li>There is an example server in <code>&lt;path_to_wolfssl&gt;</code> that can be used for testing the client. <a class="el" href="namespacewolfSSL.html">wolfSSL</a> will first need to be built. Follow the instructions <a href="https://www.wolfssl.com/wolfSSL/Docs-wolfssl-manual-2-building-wolfssl.html">here</a> to do so. See the <a href="https://wolfssl.com/wolfSSL/Docs-wolfssl-manual-3-getting-started.html">wolfSSL manual</a> for instructions on setting up the example server. From within <code>&lt;path_to_wolfssl&gt;/wolfssl</code>, the following command can be used to run the server on the host machine: <pre class="fragment"> ./examples/server/server -d -b
</pre></li>
<li>Start the example client in Workbench by following step 3 in section 3.1.</li>
<li>The following output should be expected in the simulator terminal: <pre class="fragment"> SSL version is TLSv1.2
 SSL cipher suite is TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384
 Server response: I hear you fa shizzle!
</pre></li>
</ol>
<h5>2.3 Example Server</h5>
<p>The example server requires more configuration than the client if using the VxWorks simulator.</p>
<p>Note: The <a class="el" href="namespacewolfSSL.html">wolfSSL</a> example server and client cannot run at the same time on the VxWorks simulator. Either remove or comment out the <code>client_test(&amp;args);</code> line.</p>
<ol type="1">
<li>Add the following include to usrAppInit.c: <pre class="fragment"> #include &lt;/examples/server/server.h&gt;
</pre></li>
<li>In usrAppInit.c, after the <code><a class="el" href="structfunc__args.html">func_args</a> args;</code> call, add: <pre class="fragment"> tcp_ready ready;
 ready.ready = 0;
 ready.port = 0;
 args.signal = &amp;ready;

 server_test(&amp;args);
</pre></li>
<li>Right click on the project and select "Build Project".</li>
<li><p class="startli">Start the server and complete the following: Go to "Open Connection Details" under VxWorks Simulator which is in the connections dropdown. Follow step 4 of section 3.1 to select the correct kernel image for the simulator. In "Open Connection Details" of the simulator, go to "Advanced...". Select simnetd from the Network Config dropdown and enter 192.168.200.1 as the IP address. To connect to the server running on the VxWorks Simulator, enter these commands into the host machine's terminal from any directory (for Ubuntu 14.04): </p><pre class="fragment">sudo openvpn --mktun --dev tap0
</pre><p class="startli">Note: openvpn may need to be installed first.</p>
<p class="startli">In Wind River directory on the host machine: </p><pre class="fragment">sudo vxworks-7/host/x86-linux2/bin/vxsimnetd
</pre><p class="startli">This will start the vxsimnetd application. Leave it running in the background.</p>
</li>
<li>There is an example client in <code>&lt;path_to_wolfssl&gt;/wolfssl/examples</code> . Again, <a class="el" href="namespacewolfSSL.html">wolfSSL</a> will first need to be built. Follow the instructions <a href="https://www.wolfssl.com/wolfSSL/Docs-wolfssl-manual-2-building-wolfssl.html">here</a> to do so. See the <a href="https://wolfssl.com/wolfSSL/Docs-wolfssl-manual-3-getting-started.html">wolfSSL manual</a> for instructions on how to set up the client. From within <code>&lt;path_to_wolfssl&gt;/wolfssl</code> , the following command can be used to run the client on the host machine: <pre class="fragment"> ./examples/client/client -h 192.168.200.1
</pre></li>
<li>The following output should be expected in the simulator terminal: <pre class="fragment"> SSL version is TLSv1.2
 SSL cipher suite is TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384
 Client message: hello wolfssl!
</pre></li>
</ol>
<h4>3 Necessary Files if Using VxWorks Simulator</h4>
<p>The following files are required to replicate this build:</p><ul>
<li>vxsim_linux_1_0_2_2 (directory)</li>
<li>compilers/gnu-4.8.1.5/include/c++/4.8</li>
<li>compilers/gnu-4.8.1.5/include/c++/4.8/i586-wrs-vxworks</li>
<li>compilers/gnu-4.8.1.5/lib/gcc/i586-wrs-vxworks/4.8.1/include</li>
<li>compilers/gnu-4.8.1.5/lib/gcc/i586-wrs-vxworks/4.8.1/include-fixed</li>
<li>vsb_vxsim_linux/share/h</li>
<li>vsb_vxsim_linux/krnl/h/system</li>
<li>vsb_vxsim_linux/krnl/h/public</li>
<li>vsb_vxsim_linux/krnl/configlette</li>
<li>vsb_vxsim_linux/h</li>
</ul>
<p>Note: This project was tested with a pre-built image in the VxWorks distribution called vip_vxsim_linux_gnu. </p>
</div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.14-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.14
</small></address>
</body>
</html>
